<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NET-RUNNER | Terminal System</title>
    <script>
        window.CONFIG = {
            // Por defecto usa localhost, puede ser sobrescrito por GitHub Actions durante el despliegue
            WS_URL: 'WS_URL_PLACEHOLDER'
        };
    </script>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div id="terminal">
        <div class="vhs-noise"></div>
        <canvas id="gameCanvas"></canvas>
        <div id="overlay">
            <div class="hud-top">
                <div class="hud-panel">
                    <div class="panel-header">SYSTEM_UPLINK</div>
                    <div style="display: flex; flex-direction: column; gap: 4px;">
                        <div>IDENTITY: <span id="player-name" class="accent clickable" title="Click to change name">ANONYMOUS</span> <span id="player-color-indicator" class="clickable" title="Click to change color">â—ˆ</span></div>
                        <div>STATUS: <span id="connection-status" class="status-tag disconnected">DISCONNECTED</span></div>
                        <div>THEME: <span id="theme-selector" class="accent clickable" title="Click to cycle themes">NET_RUNNER</span></div>
                    </div>
                </div>
                <div class="hud-panel stats-panel">
                    <div class="panel-header">AGENT_STATUS</div>
                    
                    <!-- Vitals with actual progress bars -->
                    <div class="vitals-container">
                        <div class="stat-row-new">
                            <div class="label-group">
                                <span class="panel-label">INTEGRITY</span>
                                <span id="hp-value" class="stat-value danger">100%</span>
                            </div>
                            <div class="progress-container integrity">
                                <div id="hp-bar" class="progress-fill integrity" style="width: 100%;"></div>
                            </div>
                        </div>
                        <div class="stat-row-new">
                            <div class="label-group">
                                <span class="panel-label">SHIELD</span>
                                <span id="shd-value" class="stat-value" style="color: #bc8cff;">100%</span>
                            </div>
                            <div class="progress-container shield">
                                <div id="shd-bar" class="progress-fill shield" style="width: 100%;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Level and XP -->
                    <div class="xp-container-new">
                        <div class="label-group">
                            <span class="panel-label">LVL <span id="player-level" class="accent">1</span></span>
                            <span id="xp-value" class="stat-value warning">0%</span>
                        </div>
                        <div class="progress-container xp">
                            <div id="xp-bar-fill" class="progress-fill xp" style="width: 0%;"></div>
                        </div>
                    </div>

                    <!-- Resources - Horizontal and more modern -->
                    <div class="resource-grid-new">
                        <div class="res-node copper">
                            <div class="res-icon">CU</div>
                            <div id="player-copper" class="res-amount">0</div>
                        </div>
                        <div class="res-node silver">
                            <div class="res-icon">AG</div>
                            <div id="player-silver" class="res-amount">0</div>
                        </div>
                        <div class="res-node gold">
                            <div class="res-icon">AU</div>
                            <div id="player-gold" class="res-amount">0</div>
                        </div>
                    </div>

                    <!-- Combat & Engine Info -->
                    <div class="info-grid-new">
                        <div class="info-item">
                            <span class="info-label">WEAPON_SYS</span>
                            <span id="player-weapon" class="info-value accent">BASIC</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">COORDINATES</span>
                            <span id="player-pos" class="info-value">0.0, 0.0</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">VELOCITY</span>
                            <span id="player-speed" class="info-value">0.00</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">THRUST</span>
                            <span id="player-accel" class="info-value">0.00</span>
                        </div>
                    </div>

                    <!-- System Performance -->
                    <div class="sys-perf-new">
                        <div class="perf-item">
                            <span id="latency" class="accent">--ms</span>
                            <span class="perf-label">LAT</span>
                        </div>
                        <div class="perf-item">
                            <span id="fps" class="success">--</span>
                            <span class="perf-label">FPS</span>
                        </div>
                    </div>
                </div>
            </div>
            

            <div id="logs-container" style="position: absolute; bottom: 80px; left: 40px; pointer-events: auto;">
                <div id="debug-panel" class="hud-panel" style="display: none;">
                    <div class="panel-header" style="color: var(--success);">[DEBUG_SYSTEM_ACTIVE]</div>
                    <div id="debug-content">
                        <!-- Debug info will be injected here -->
                    </div>
                </div>
                <div class="hud-panel">
                    <div class="panel-header">CONSOLE_LOGS</div>
                    <div id="logs">
                        <div class="log-entry">> Initializing secure connection...</div>
                        <div class="log-entry">> Waiting for uplink...</div>
                    </div>
                    <div style="display: flex; align-items: center; width: 100%; border-top: 1px dotted var(--border); padding-top: 10px; margin-top: 5px;">
                        <span class="accent" style="margin-right: 10px;">></span>
                        <input type="text" id="chat-input" placeholder="Type command or message..." autocomplete="off" 
                               style="background: transparent; border: none; color: #c9d1d9; outline: none; flex-grow: 1; font-family: inherit; font-size: 12px;">
                    </div>
                </div>
            </div>

            <div id="minimap-container" style="position: absolute; bottom: 80px; right: 40px; pointer-events: auto;">
                <div id="minimap-panel" class="hud-panel">
                    <div class="panel-header">RADAR_SYSTEM</div>
                    <canvas id="minimapCanvas" style="height: 180px;"></canvas>
                    <div id="player-list">
                        <!-- Players will be listed here -->
                    </div>
                </div>
            </div>

            <div id="tutorial-panel" class="hud-bottom">
                <div class="hud-panel">
                    <div class="panel-header" style="text-align: center;">OPERATIONAL_GUIDE</div>
                    <div id="guide-content" style="text-align: center;">
                        <span class="accent">WASD</span> to navigate | <span class="accent">SPACE/CLICK</span> to shoot | <span class="accent">C</span> to scan | <span class="accent">F11</span> full extraction
                    </div>
                </div>
            </div>

            <!-- Redesigned Shop Panel v5.0 -->
            <div id="shop-panel" class="hud-panel shop-container" style="display: none; pointer-events: auto; z-index: 100;">
                <div class="panel-header shop-header">
                    <span>BLACK_MARKET_TERMINAL // v5.0</span>
                    <div class="shop-controls">
                        <span class="shop-status">SECURE_LINK_ESTABLISHED</span>
                        <span class="shop-close clickable" onclick="closeShop()">[EXIT]</span>
                    </div>
                </div>
                
                <div class="shop-content-wrapper">
                    <div class="shop-sub-header">
                        <div class="shop-balance-v5">
                            <div class="res-item"><span class="label" style="color: #b87333;">CU</span> <span id="shop-cu">0</span></div>
                            <div class="res-item"><span class="label" style="color: #c0c0c0;">AG</span> <span id="shop-ag">0</span></div>
                            <div class="res-item"><span class="label" style="color: #ffd700;">AU</span> <span id="shop-au">0</span></div>
                        </div>
                        <nav class="shop-tabs">
                            <div class="tab-btn active" onclick="filterShop('all', this)">[ ALL_ENTRIES ]</div>
                            <div class="tab-btn" onclick="filterShop('arm', this)">[ ARMAMENT ]</div>
                            <div class="tab-btn" onclick="filterShop('sys', this)">[ UPGRADES ]</div>
                            <div class="tab-btn" onclick="filterShop('spc', this)">[ SPECIAL ]</div>
                            <div class="tab-btn" onclick="filterShop('exc', this)">[ EXCHANGE ]</div>
                        </nav>
                    </div>

                    <div id="shop-items" class="shop-grid">
                        <!-- ARMAMENT -->
                        <div class="shop-item-v5" data-category="arm" onclick="buyItem('WEAPON_SHOTGUN')">
                            <div class="item-id">#WPN_01</div>
                            <div class="item-name">STREET_SWEEPER</div>
                            <div class="item-desc">High-spread combat shotgun modules.</div>
                            <div class="item-footer">
                                <span class="price-v5 gold">10 AU</span>
                                <span class="buy-label">INIT_BUY</span>
                            </div>
                        </div>
                        <div class="shop-item-v5" data-category="arm" onclick="buyItem('WEAPON_LASER')">
                            <div class="item-id">#WPN_02</div>
                            <div class="item-name">PULSE_LASER</div>
                            <div class="item-desc">High-frequency accurate beam system.</div>
                            <div class="item-footer">
                                <span class="price-v5 gold">25 AU</span>
                                <span class="buy-label">INIT_BUY</span>
                            </div>
                        </div>
                        <div class="shop-item-v5" data-category="arm" onclick="buyItem('WEAPON_MISSILE')">
                            <div class="item-id">#WPN_03</div>
                            <div class="item-name">HELLFIRE_MISSILE</div>
                            <div class="item-desc">Massive explosive ordinance arrays.</div>
                            <div class="item-footer">
                                <span class="price-v5 gold">50 AU</span>
                                <span class="buy-label">INIT_BUY</span>
                            </div>
                        </div>

                        <!-- UPGRADES -->
                        <div class="shop-item-v5" data-category="sys" onclick="buyItem('UPGRADE_SHIELD')">
                            <div class="item-id">#SYS_01</div>
                            <div class="item-name">SHIELD_CAPACITY</div>
                            <div class="item-desc">Reinforce buffer layers [+5 SHD].</div>
                            <div class="item-footer">
                                <span class="price-v5 silver">50 AG</span>
                                <span class="buy-label">INIT_BUY</span>
                            </div>
                        </div>
                        <div class="shop-item-v5" data-category="sys" onclick="buyItem('UPGRADE_HP')">
                            <div class="item-id">#SYS_02</div>
                            <div class="item-name">HULL_INTEGRITY</div>
                            <div class="item-desc">Reinforce physical structure [+5 HP].</div>
                            <div class="item-footer">
                                <span class="price-v5 copper">100 CU</span>
                                <span class="buy-label">INIT_BUY</span>
                            </div>
                        </div>
                        <div class="shop-item-v5" data-category="sys" onclick="buyItem('REPAIR')">
                            <div class="item-id">#SYS_03</div>
                            <div class="item-name">FULL_REPAIR</div>
                            <div class="item-desc">Restore all hull integrity systems.</div>
                            <div class="item-footer">
                                <span class="price-v5 copper">20 CU</span>
                                <span class="buy-label">INIT_BUY</span>
                            </div>
                        </div>

                        <!-- SPECIAL -->
                        <div class="shop-item-v5" data-category="spc" onclick="buyItem('UPGRADE_AUTO_MINER')">
                            <div class="item-id">#SPC_01</div>
                            <div class="item-name">AUTO_EXTRACTOR</div>
                            <div class="item-desc">Autonomous resource harvester unit.</div>
                            <div class="item-footer">
                                <span class="price-v5 gold">30 AU</span>
                                <span class="buy-label">INIT_BUY</span>
                            </div>
                        </div>

                        <!-- EXCHANGE -->
                        <div class="shop-item-v5" data-category="exc" onclick="buyItem('TRADE_AU_TO_AG')">
                            <div class="item-id">#EXC_01</div>
                            <div class="item-name">AU -> AG</div>
                            <div class="item-desc">Convert 1 GOLD into 4 SILVER.</div>
                            <div class="item-footer">
                                <span class="price-v5 gold">1 AU</span>
                                <span class="buy-label">INIT_BUY</span>
                            </div>
                        </div>
                        <div class="shop-item-v5" data-category="exc" onclick="buyItem('TRADE_AG_TO_AU')">
                            <div class="item-id">#EXC_02</div>
                            <div class="item-name">AG -> AU</div>
                            <div class="item-desc">Convert 6 SILVER into 1 GOLD.</div>
                            <div class="item-footer">
                                <span class="price-v5 silver">6 AG</span>
                                <span class="buy-label">INIT_BUY</span>
                            </div>
                        </div>
                        <div class="shop-item-v5" data-category="exc" onclick="buyItem('TRADE_AG_TO_CU')">
                            <div class="item-id">#EXC_03</div>
                            <div class="item-name">AG -> CU</div>
                            <div class="item-desc">Convert 1 SILVER into 4 COPPER.</div>
                            <div class="item-footer">
                                <span class="price-v5 silver">1 AG</span>
                                <span class="buy-label">INIT_BUY</span>
                            </div>
                        </div>
                        <div class="shop-item-v5" data-category="exc" onclick="buyItem('TRADE_CU_TO_AG')">
                            <div class="item-id">#EXC_04</div>
                            <div class="item-name">CU -> AG</div>
                            <div class="item-desc">Convert 6 COPPER into 1 SILVER.</div>
                            <div class="item-footer">
                                <span class="price-v5 copper">6 CU</span>
                                <span class="buy-label">INIT_BUY</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="mobile-controls">
                <div id="joystick-zone">
                    <div id="joystick-base">
                        <div id="joystick-stick"></div>
                    </div>
                </div>
                <div id="mobile-actions">
                    <button id="btn-scan" class="hud-panel mobile-btn">SCAN</button>
                    <button id="btn-shoot" class="hud-panel mobile-btn">FIRE</button>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/@msgpack/msgpack@3.0.0-beta2/dist.es5+umd/msgpack.min.js"></script>
    <script src="js/game.js"></script>
</body>
</html>
